<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 2 Spatial data in R | Elegant and informative maps with tmap</title>
  <meta name="description" content="This is a book in progress about the tmap package." />
  <meta name="generator" content="bookdown 0.20.3 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 2 Spatial data in R | Elegant and informative maps with tmap" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="This is a book in progress about the tmap package." />
  <meta name="github-repo" content="mtennekes/tmap_book" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 2 Spatial data in R | Elegant and informative maps with tmap" />
  
  <meta name="twitter:description" content="This is a book in progress about the tmap package." />
  

<meta name="author" content="Martijn Tennekes, Jakub Nowosad" />


<meta name="date" content="2020-09-07" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="intro.html"/>
<link rel="next" href="nutshell.html"/>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<script src="libs/accessible-code-block-0.0.1/empty-anchor.js"></script>
<script src="libs/kePrint-0.0.1/kePrint.js"></script>
<link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet" />
<link href="libs/bsTable-3.3.7/bootstrapTable.min.css" rel="stylesheet" />
<script src="libs/bsTable-3.3.7/bootstrapTable.js"></script>
<!-- a placeholder for a google analytics script -->
<script>
</script>


<style type="text/css">
code.sourceCode > span { display: inline-block; line-height: 1.25; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style/style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">tmap: elegant and effective thematic maps in R</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Welcome</a><ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#how-to-contribute"><i class="fa fa-check"></i>How to contribute?</a></li>
</ul></li>
<li class="chapter" data-level="1" data-path="intro.html"><a href="intro.html"><i class="fa fa-check"></i><b>1</b> Introduction</a><ul>
<li class="chapter" data-level="1.1" data-path="intro.html"><a href="intro.html#what-is-tmap"><i class="fa fa-check"></i><b>1.1</b> What is <strong>tmap</strong>?</a></li>
<li class="chapter" data-level="1.2" data-path="intro.html"><a href="intro.html#thematic-maps"><i class="fa fa-check"></i><b>1.2</b> Thematic maps</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="geodata.html"><a href="geodata.html"><i class="fa fa-check"></i><b>2</b> Spatial data in R</a><ul>
<li class="chapter" data-level="2.1" data-path="geodata.html"><a href="geodata.html#introduction"><i class="fa fa-check"></i><b>2.1</b> Introduction</a></li>
<li class="chapter" data-level="2.2" data-path="geodata.html"><a href="geodata.html#data-models"><i class="fa fa-check"></i><b>2.2</b> Data models</a><ul>
<li class="chapter" data-level="2.2.1" data-path="geodata.html"><a href="geodata.html#vector-data-model"><i class="fa fa-check"></i><b>2.2.1</b> Vector data model</a></li>
<li class="chapter" data-level="2.2.2" data-path="geodata.html"><a href="geodata.html#raster-data-model"><i class="fa fa-check"></i><b>2.2.2</b> Raster data model</a></li>
<li class="chapter" data-level="2.2.3" data-path="geodata.html"><a href="geodata.html#spatial-data-cubes"><i class="fa fa-check"></i><b>2.2.3</b> Spatial data cubes</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="geodata.html"><a href="geodata.html#spatial-data-representations-in-r"><i class="fa fa-check"></i><b>2.3</b> Spatial data representations in R</a><ul>
<li class="chapter" data-level="2.3.1" data-path="geodata.html"><a href="geodata.html#the-sf-package"><i class="fa fa-check"></i><b>2.3.1</b> The sf package</a></li>
<li class="chapter" data-level="2.3.2" data-path="geodata.html"><a href="geodata.html#the-stars-package"><i class="fa fa-check"></i><b>2.3.2</b> The stars package</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="geodata.html"><a href="geodata.html#crs"><i class="fa fa-check"></i><b>2.4</b> Map projections (CRS)</a><ul>
<li class="chapter" data-level="2.4.1" data-path="geodata.html"><a href="geodata.html#what-are-map-projections"><i class="fa fa-check"></i><b>2.4.1</b> What are map projections?</a></li>
<li class="chapter" data-level="2.4.2" data-path="geodata.html"><a href="geodata.html#a-model-of-the-earth"><i class="fa fa-check"></i><b>2.4.2</b> A model of the Earth</a></li>
<li class="chapter" data-level="2.4.3" data-path="geodata.html"><a href="geodata.html#platte-carrÃ©e-and-web-mercator"><i class="fa fa-check"></i><b>2.4.3</b> Platte CarrÃ©e and Web Mercator</a></li>
<li class="chapter" data-level="2.4.4" data-path="geodata.html"><a href="geodata.html#types-of-map-projections"><i class="fa fa-check"></i><b>2.4.4</b> Types of map projections</a></li>
<li class="chapter" data-level="2.4.5" data-path="geodata.html"><a href="geodata.html#which-projection-to-choose"><i class="fa fa-check"></i><b>2.4.5</b> Which projection to choose?</a></li>
<li class="chapter" data-level="2.4.6" data-path="geodata.html"><a href="geodata.html#crs-in-r"><i class="fa fa-check"></i><b>2.4.6</b> CRS in R</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="nutshell.html"><a href="nutshell.html"><i class="fa fa-check"></i><b>3</b> <strong>tmap</strong> in a nutshell</a></li>
<li class="chapter" data-level="4" data-path="tmshape.html"><a href="tmshape.html"><i class="fa fa-check"></i><b>4</b> Specifying spatial data with <code>tm_shape</code></a></li>
<li class="chapter" data-level="5" data-path="layers.html"><a href="layers.html"><i class="fa fa-check"></i><b>5</b> Layers</a><ul>
<li class="chapter" data-level="5.1" data-path="layers.html"><a href="layers.html#shapes-and-markers"><i class="fa fa-check"></i><b>5.1</b> Shapes and markers <!--JN: I am not sure where this section should go--></a></li>
<li class="chapter" data-level="5.2" data-path="layers.html"><a href="layers.html#color-palettes"><i class="fa fa-check"></i><b>5.2</b> Color palettes <!--JN: I am not sure where this section should go--></a></li>
<li class="chapter" data-level="5.3" data-path="layers.html"><a href="layers.html#the-color-scale-styles"><i class="fa fa-check"></i><b>5.3</b> The color scale styles <!--JN: I am not sure where this section should go--></a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="othertypes.html"><a href="othertypes.html"><i class="fa fa-check"></i><b>6</b> Other types</a></li>
<li class="chapter" data-level="7" data-path="layout.html"><a href="layout.html"><i class="fa fa-check"></i><b>7</b> Layout</a></li>
<li class="chapter" data-level="8" data-path="interactive.html"><a href="interactive.html"><i class="fa fa-check"></i><b>8</b> Interactive settings</a></li>
<li class="chapter" data-level="9" data-path="multiples.html"><a href="multiples.html"><i class="fa fa-check"></i><b>9</b> Small multiples</a></li>
<li class="chapter" data-level="10" data-path="options.html"><a href="options.html"><i class="fa fa-check"></i><b>10</b> tmap options</a></li>
<li class="chapter" data-level="11" data-path="save.html"><a href="save.html"><i class="fa fa-check"></i><b>11</b> Save maps</a></li>
<li class="chapter" data-level="12" data-path="animations.html"><a href="animations.html"><i class="fa fa-check"></i><b>12</b> Animations</a></li>
<li class="chapter" data-level="13" data-path="shiny.html"><a href="shiny.html"><i class="fa fa-check"></i><b>13</b> <strong>tmap</strong> in <strong>shiny</strong></a></li>
<li class="chapter" data-level="14" data-path="goodmaps.html"><a href="goodmaps.html"><i class="fa fa-check"></i><b>14</b> How to make good maps?</a></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="https://mtennekes.github.io/">Martijn Tennekes</a></li>
<li><a href="https://nowosad.github.io/">Jakub Nowosad</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Elegant and informative maps with <strong>tmap</strong></a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="geodata" class="section level1">
<h1><span class="header-section-number">Chapter 2</span> Spatial data in R</h1>
<!-- # Geographic data in R {#geodata} -->
<!-- to discuss -->
<p></p>
<div id="introduction" class="section level2">
<h2><span class="header-section-number">2.1</span> Introduction</h2>
<p>Vector and raster data models are two basic models used to represent spatial data.
These spatial data models are closely related to map making, with each model having its own pros and cons.
<!-- - few introduction sections -->
<!-- - mention GDAL, PROJ, and GEOS -->
<!-- - maybe also mention some data sources -->
This chapter stars by describing several popular spatial data models (section <a href="geodata.html#data-models">2.2</a>).
Each data model is introduced, explained how it is built, and how it is stored using different file formats.
Next, this chapter presents how these different data models are implemented in R (section <a href="geodata.html#spatial-data-representations-in-r">2.3</a>.
It includes showing how to read different spatial data formats, how to understand spatial R objects, and where to find more information about preprocessing spatial data.
Finally, it focuses on the map projections (<a href="geodata.html#crs">2.4</a>).
This section gives a background on why do we need map projections and how to translate spatial data from an ellipsoid into a flat surface or computer screen.
It also explains basic terms and gives an overview of map projections.
<!-- - maybe also references to some books (either here or in the next section or both) -->
<!-- geocompr, spatial data science, some crs book? -->
<!-- explain that often there is a need to prepare spatial data before mapping --></p>
</div>
<div id="data-models" class="section level2">
<h2><span class="header-section-number">2.2</span> Data models</h2>
<p>Traditionally, spatial data is described by two basic data models:
vector data model aimed at (section <a href="geodata.html#vector-data-model">2.2.1</a>) representing the world using points, lines, and polygons, and raster data model focused on representing surfaces (section <a href="geodata.html#raster-data-model">2.2.2</a>).
Additionally, now we have an abundance of available spatial data and a variety of ways to obtain it.
It includes having many district variables and repeated measurements for the same area.
Therefore, we also present the concept of spatial data cubes (section <a href="geodata.html#spatial-data-cubes">2.2.3</a>).</p>
<div id="vector-data-model" class="section level3">
<h3><span class="header-section-number">2.2.1</span> Vector data model</h3>
<p>


The vector data model represent the world as a set of spatial geometries with non-spatial attributes (Figure <a href="geodata.html#fig:vector-data-model">2.1</a>).
The role of geometry is to describe the location and shape of spatial objects.
Attributes, on the other hand, are used to store the properties of the data.</p>
<p>
There are three basic types of geometries: points, lines, and polygons, all of them are made up of coordinates (left part of Figure <a href="geodata.html#fig:vector-data-model">2.1</a>).
A point is represented by a pair of coordinates, usually described as X and Y, allowing for locating this point in some space.
X and Y could be unitless, in degrees, or in some measure units, such as meters (extended discussion on coordinates and related topics is in section <a href="geodata.html#crs">2.4</a>).
Points can represent features on different spatial scales, from a GPS position, location of a bench in a park, to a city on a small scale map.
They are also used to express abstract features, such as locations of map labels.
Properties of points<!--,such as ...--> can be expressed on maps by different point sizes, colors, or shapes<!--(markers/images) -->.
A line extends the idea of a point.
It consists of several points (with coordinates)<!--vertex--> that are arranged in some order.
Consecutive points are connected by straight lines.
Therefore, a straight spatial line consists of two points (two pairs of coordinates), while complex spatial lines could be created based on a large number of points.<!--to rewrite-->
It gives the illusion that the line is curved.
Lines are used to representing linear features, such as roads, rivers, boundaries, footpaths, etc.
In this case, we can express line featuresâ€™ attributes using either linesâ€™ color or their widths.
<!-- ways to adjust lines aesthetics: colors, lwd (line width) -->
<!-- in theory lty could be also used - but it is not implemented in tmap -->
A polygon is again a set of ordered points connected by straight lines.
Its only difference from the line is that the first and the last point in a polygon has the same coordinates, and thus close the object.
<!-- examples of polygons -->
The polygon representation is used to represent shapes and locations of different objects, from a lake or a patch of vegetation, through a building or a city block, to some administrative units.
Polygons also have one unique feature - they could have holes.
A polygon hole represents an area inside of the polygon but does not belong to it.
For example, a lake with an island can be depicted as a polygon with a hole.
The values of polygonsâ€™ attributes can be represented by the areas (fill) colors.</p>
<p>
The second part of the vector data model relates to non-spatial attributes (right part of Figure <a href="geodata.html#fig:vector-data-model">2.1</a>).
Attributes are usually stored as a table, in which each column depicts some property, such as an identification number, a name of a feature, or a value of some characteristic.
Each row, on the other hand, relates to a single spatial geometry.</p>
<pre><code>#&gt; 
#&gt; Attaching package: &#39;dplyr&#39;
#&gt; The following objects are masked from &#39;package:stats&#39;:
#&gt; 
#&gt;     filter, lag
#&gt; The following objects are masked from &#39;package:base&#39;:
#&gt; 
#&gt;     intersect, setdiff, setequal, union</code></pre>
<div class="figure" style="text-align: center"><span id="fig:vector-data-model"></span>
<img src="02-geodata_files/figure-html/vector-data-model-1.png" alt="Instances of spatial vector data model: POINTS, LINES, and POLYGONS." width="480" />
<p class="caption">
FIGURE 2.1: Instances of spatial vector data model: POINTS, LINES, and POLYGONS.
</p>
</div>
<p>
The above ideas could be implemented in many ways. <!--...-->
Currently, <a href="http://portal.opengeospatial.org/files/?artifact_id=25355">the Simple Feature Access</a> seems to be the most widely used standard.
In it, a feature is every object or concept that have spatial location or extent.</p>
<p>Simple feature standard makes a clear distinction between single- and multi-element features.
We can have a POINT feature and a MULTIPOINT feature, and similarly LINESTRING and MULTILINESTRING, and POLYGON and MULTIPOLYGON.
The main difference between single element features (such as POINT or POLYGON) and multi-element features (such as MULTIPOINT or MULTIPOLYGON) can be clearly seen by looking at attribute tables.
For example, six points stored as POINT features fill six separate rows, while six points stored as just one MULTIPOINT feature occupy just one row.
<!-- redundancy -->
Examples of single- and multi-element features can be seen in Figure <a href="geodata.html#fig:vector-data-model">2.1</a>.
The top example shows point data represented as MULTIPOINT feature: although we have seven points (seven distinct pairs of coordinates), they are gathered into two groups, green and orange, which can be seen in the associated attribute table.
The central example, on the other hand, uses single-element features, where each line geometry relates to one row in the attribute table.
Finally, the bottom example again uses multi-element features, where the second feature (<code>Country B</code>) consist of two separate geometries.
The simple feature standard also describes a number of additional geometry types, including Curve, Surface, or Triangle.
Finally, GeometryCollection exists that contains all of the possible geometry types.</p>
<!-- JN: maybe too much information-->
<!-- simple features standard also defines possible topological rules -->
<p>
A couple hundreds of file formats exist to store spatial vector data.
One of the simplest ways to store spatial data is in the form of a text file (<code>.csv</code>) or as a spreadsheet (<code>.xls</code> or <code>.xlsx</code>).
While it makes storing point data simple, with two columns representing coordinates, it is not easy to store more complex objects in this way.
Text files are also not suitable for storing information about the coordinate reference system used (section <a href="geodata.html#crs">2.4</a>).
Historically, the shapefile format (<code>.shp</code>) developed by the ESRI company gained a lot of interest and become the most widely supported spatial vector file format.
Despite its popularity, this format has a number of shortcomings, including the need to store several files, attribute names limited to ten characters, the ability to store up to 255 attributes and files up to 2GB, and many more.
A fairly recent file format, OGC GeoPackage (<code>.gpkg</code>), was developed as an alternative.
It is a single file database free from the limitation of the shapefile format.
Other popular spatial vector file formats include GeoJSON (<code>.geojson</code>), GPX (<code>.gpx</code>), and KML (<code>.kml</code>).
<!-- FlatGeobuf?? -->
<!-- - advantages/disadvantages --></p>
</div>
<div id="raster-data-model" class="section level3">
<h3><span class="header-section-number">2.2.2</span> Raster data model</h3>
<p>
The raster data model represents the world using a continuous grid of cells<!--pixels-->, where each cell has a single associated value (Figure <a href="geodata.html#fig:raster-intro">2.2</a>).
Depending on the type of values, we can distinguish continuous and categorical rasters.
In continuous rasters, such as elevation or precipitation, values vary progressively.
Categorical rasters, on the other hand, uses integer values to represent classes.
Their examples include land cover or soil types maps.
Raster data can also contain cells for which we do not know the value (Figure <a href="geodata.html#fig:raster-intro">2.2</a>).
For example, data for this part of the area was not collected, or these locations are outside of our area of interest.</p>
<div class="figure" style="text-align: center"><span id="fig:raster-intro"></span>
<img src="02-geodata_files/figure-html/raster-intro-1.png" alt="Basic representation of the raster data model: (1) Cell IDs, (2) Cell values, and (3) A raster map" width="672" />
<p class="caption">
FIGURE 2.2: Basic representation of the raster data model: (1) Cell IDs, (2) Cell values, and (3) A raster map
</p>
</div>
<p>
When we think about raster data, most of the time we are referring to regular grids (Figure <a href="geodata.html#fig:grid-types">2.3</a>).
In regular grids, each cell has the same, constant size, and coordinates change from top to bottom and from left to right<a href="#fn1" class="footnote-ref" id="fnref1"><sup>1</sup></a>.
<!-- I know it is a simplification-->
Regular rasters can be transformed into rotated and sheared rasters (Figure <a href="geodata.html#fig:grid-types">2.3</a>).
Rotated grids are the result of transforming both coordinated, <span class="math inline">\(x\)</span> and <span class="math inline">\(y\)</span> using the same rotation coefficients.
Sheared grids are created when the rotation coefficients are not equal.
Rectilinear grids, on the other hand, have orthogonal axes, but consist of rectangular cells with different sizes and shapes (Figure <a href="geodata.html#fig:grid-types">2.3</a>).
In the last type of raster data grids, curvilinear grids, cells are cuboids of different sizes and shapes (Figure <a href="geodata.html#fig:grid-types">2.3</a>).</p>
<!-- Q:should the counting in the below figure start from bottom left? -->
<div class="figure" style="text-align: center"><span id="fig:grid-types"></span>
<img src="02-geodata_files/figure-html/grid-types-1.png" alt="Main types of raster data grids: (1) Regular, (2) Rotated, (3) Sheared, (4) Rectilinear, and (5) Curvilinear" width="672" />
<p class="caption">
FIGURE 2.3: Main types of raster data grids: (1) Regular, (2) Rotated, (3) Sheared, (4) Rectilinear, and (5) Curvilinear
</p>
</div>
<p>Contrary to spatial vector data, a basic raster data stores just one attribute.
It is, however, possible to stack together many single rasters (also known as raster layers).
This allows us to store and operate on many rasters having the same dimensions at the same time.
Examples of multi-layer rasters include satellite imageries or temporal rasters.
Satellite imageries usually consist of many bands (layers) for different wavelengths.
The most basic bands, representing the colors red, green, and blue, can be connected together to create one composite image with true colors (Figure <a href="geodata.html#fig:rgb-raster">2.4</a>).
Temporal rasters store one attribute, but for many moments in time.
<!-- + comparing different attributes for the same area -->
Additional information about multi-layer rasters can be also found in Section <a href="geodata.html#spatial-data-cubes">2.2.3</a>.</p>
<div class="figure" style="text-align: center"><span id="fig:rgb-raster"></span>
<img src="02-geodata_files/figure-html/rgb-raster-1.png" alt="Example of three satellite imagery bands: red, green, blue, and the composite image with true colors created using these three bands." width="672" />
<p class="caption">
FIGURE 2.4: Example of three satellite imagery bands: red, green, blue, and the composite image with true colors created using these three bands.
</p>
</div>
<p>
Similarly to vector data, a large number of raster file formats exists.
<!-- text files ?-->
Currently, the GeoTIFF format (<code>.tif</code> or <code>.tiff</code>) is one of the most popular spatial raster formats.
It is an extended image TIF format that stores spatial metadata (e.g., map projection) along the values.
Another popular spatial raster formats include Arc ASCII (<code>.asc</code>) and ERDAS Imagine (<code>.img</code>).
<!-- ncdf??? --></p>
</div>
<div id="spatial-data-cubes" class="section level3">
<h3><span class="header-section-number">2.2.3</span> Spatial data cubes</h3>
<p>
Traditionally, spatial vector and raster data models refer to a unique set of locations.
For example, each feature in a polygon dataset and each cell in a raster dataset refer to one specific area.
However, to solve real-life problems, we need to store and operate on more complex data structures.
It includes situations when we have many attributes, often for several moments in time.</p>
<p>
Storing multiple attributes is not a problem for the vector data model, when an attribute table can have many columns.
The question is how to extend the spatial vector data model to include measurements for many times.
For example, letâ€™s consider a polygon data with many attributes representing shares of land-use types for several years (Figure <a href="geodata.html#fig:vector-data-cubes">2.5</a>).
One approach would be to create a separate column for each variable in each year.<!--wide--><!--pros and cons-->
Alternatively, we can have one column representing the year and one column for each attribute, however, this approach would require multiplying each geometry as many times as we have time stamps.
<!--long--><!--pros and cons-->
The third approach involves separating geometries from attributes, and where attributes for each moment are stored independently.
The last idea is used in spatial vector data cubes (section <a href="geodata.html#the-stars-package">2.3.2</a>).
An example of the spatial vector data cubes idea can be seen in Figure <a href="geodata.html#fig:vector-data-cubes">2.5</a>.
It consists of two elements: a geometry (MULTIPOLYGON) of provinces of the Netherlands and an array connected to it that stores shares of land-use types for several years.</p>
<div class="figure" style="text-align: center"><span id="fig:vector-data-cubes"></span>
<img src="02-geodata_files/figure-html/vector-data-cubes-1.png" alt="Vector data cube." width="576" />
<p class="caption">
FIGURE 2.5: Vector data cube.
</p>
</div>
<p>
A single raster dataset can store just one variable for a given area.
To store several attributes, we can connect rasters representing different attributes for the same extent, creating multi-layer rasters (section <a href="geodata.html#raster-data-model">2.2.2</a>).
Additionally, each of the aforementioned rasters can be collected for many moments in time, adding other layers to the data.
<!--pros and cons-->
The question here is how to efficiently store multi-layer raster data to understand what layers relate to which attribute and time.
Similarly to spatial vector data cubes, we can think of separating spatial dimensions from non-spatial attributes and create spatial raster data cubes (section <a href="geodata.html#the-stars-package">2.3.2</a>).
Figure <a href="geodata.html#fig:raster-data-cubes">2.6</a> gives an example of a raster data cube.
It consists of several single-layer rasters with the same spatial properties, such as resolution, extent, and CRS.
These rasters are organized to store four-dimensions of the data: latitude, longitude, time, and attributes.
It has values of three attributes for five moments in time in total.</p>
<div class="figure" style="text-align: center"><span id="fig:raster-data-cubes"></span>
<img src="02-geodata_files/figure-html/raster-data-cubes-1.png" alt="Raster data cube." width="672" />
<p class="caption">
FIGURE 2.6: Raster data cube.
</p>
</div>
<p>Spatial data cubes are suitable for many real-life applications.
For example, time-series of climate measurements for several stations, demographic data on a country level gathered for many years, or satellite imageries over some period of time.</p>
<p>
One way to create spatial data cubes is by connecting many independent vector or raster objects.
<!-- mention it in the stars section? -->
Second way is to read a spatial data cube from one of the file formats allowing for storing complex data.
It includes formats such as NetCDF (<code>.nc</code>) and HDF (<code>.hdf</code>).
<!-- spatial vector data cubes file formats? --></p>
<!-- converting between spatial vector data cube and spatial raster data cube -->
</div>
</div>
<div id="spatial-data-representations-in-r" class="section level2">
<h2><span class="header-section-number">2.3</span> Spatial data representations in R</h2>
<p>
R has several packages aimed to represent spatial vector data.
<!-- Recently, the **terra** package has been released containing a new vector data representation. -->
For more than a decade, the <strong>sp</strong> package <!--REF--> was a standard of vector data representation in R.
However, now this package is in the maintenance mode only, and its successor, <strong>sf</strong> is recommended.
The <strong>tmap</strong> package has been using <strong>sf</strong> since version 2.0.</p>
<p>

Several R packages can be used to represent spatial raster data, including <strong>raster</strong> and its successor <strong>terra</strong>.
The <strong>raster</strong> package was used as a backbone of raster data visualization until <strong>tmap</strong> version 3.0.
Nowadays, the <strong>stars</strong> package is used by <strong>tmap</strong> to operate on raster data and spatial data cubes.</p>
<p>In the two next sections, we introduce the <strong>sf</strong> package (<a href="geodata.html#the-sf-package">2.3.1</a>) and the <strong>stars</strong> package (section <a href="geodata.html#the-stars-package">2.3.2</a>).</p>
<!-- spatial data cubes -->
<!-- https://github.com/appelmar/gdalcubes_R -->
<!-- https://ropensci.org/blog/2019/11/05/tidync/ -->
<div id="the-sf-package" class="section level3">
<h3><span class="header-section-number">2.3.1</span> The sf package</h3>
<p>
</p>
<p>The <strong>sf</strong> package implements ideas behind the Simple Feature standard, which describe how to represent spatial vector data.
Its main class, <code>sf</code>, has the form of an extended data frame, where each row is a spatial feature.
In it, attributes of the vector data are stored as columns.
It also has one additional column, most often named <code>geom</code> or <code>geometry</code><a href="#fn2" class="footnote-ref" id="fnref2"><sup>2</sup></a>.
This column contains geometries in a form of well-known text (WKT), storing all of the coordinates.</p>
<!-- - how to read sf objects from files -->
<p>The <strong>sf</strong> package can read all of the spatial data formats mentioned in section <a href="geodata.html#vector-data-model">2.2.1</a> using the <code>read_sf()</code> function<a href="#fn3" class="footnote-ref" id="fnref3"><sup>3</sup></a>.
<!--improve example--></p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="geodata.html#cb2-1"></a><span class="co"># replace this data with some new tmap dataset</span></span>
<span id="cb2-2"><a href="geodata.html#cb2-2"></a><span class="kw">library</span>(sf)</span>
<span id="cb2-3"><a href="geodata.html#cb2-3"></a>file_path =<span class="st"> </span><span class="kw">system.file</span>(<span class="st">&quot;shapes/world.gpkg&quot;</span>, <span class="dt">package =</span> <span class="st">&quot;spData&quot;</span>)</span>
<span id="cb2-4"><a href="geodata.html#cb2-4"></a>x =<span class="st"> </span><span class="kw">read_sf</span>(file_path)</span></code></pre></div>
<p>The new object, <code>x</code>, has a <code>sf</code> class.
It has 177 features (rows or geometries) and 10 fields (columns with attributes).
There is also an 11th column, <code>geom</code>, that stores geometries of each feature.
Objects of class <code>sf</code> also display a header containing spatial metadata.
It includes geometry type, dimension (<code>XY</code>, <code>XYZ</code>, <code>XYM</code>, <code>XYZM</code>), bounding box (<code>bbox</code>), and information about the used Coordinate Reference System (<code>CRS</code>).</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="geodata.html#cb3-1"></a>x</span>
<span id="cb3-2"><a href="geodata.html#cb3-2"></a><span class="co">#&gt; Simple feature collection with 177 features and 10 fields</span></span>
<span id="cb3-3"><a href="geodata.html#cb3-3"></a><span class="co">#&gt; geometry type:  MULTIPOLYGON</span></span>
<span id="cb3-4"><a href="geodata.html#cb3-4"></a><span class="co">#&gt; dimension:      XY</span></span>
<span id="cb3-5"><a href="geodata.html#cb3-5"></a><span class="co">#&gt; bbox:           xmin: -180 ymin: -90 xmax: 180 ymax: 83.6</span></span>
<span id="cb3-6"><a href="geodata.html#cb3-6"></a><span class="co">#&gt; geographic CRS: WGS 84</span></span>
<span id="cb3-7"><a href="geodata.html#cb3-7"></a><span class="co">#&gt; [90m# A tibble: 177 x 11[39m</span></span>
<span id="cb3-8"><a href="geodata.html#cb3-8"></a><span class="co">#&gt;    iso_a2 name_long continent region_un subregion type </span></span>
<span id="cb3-9"><a href="geodata.html#cb3-9"></a><span class="co">#&gt;    [3m[90m&lt;chr&gt;[39m[23m  [3m[90m&lt;chr&gt;[39m[23m     [3m[90m&lt;chr&gt;[39m[23m     [3m[90m&lt;chr&gt;[39m[23m     [3m[90m&lt;chr&gt;[39m[23m     [3m[90m&lt;chr&gt;[39m[23m</span></span>
<span id="cb3-10"><a href="geodata.html#cb3-10"></a><span class="co">#&gt; [90m 1[39m FJ     Fiji      Oceania   Oceania   Melanesia Soveâ€¦</span></span>
<span id="cb3-11"><a href="geodata.html#cb3-11"></a><span class="co">#&gt; [90m 2[39m TZ     Tanzania  Africa    Africa    Eastern â€¦ Soveâ€¦</span></span>
<span id="cb3-12"><a href="geodata.html#cb3-12"></a><span class="co">#&gt; [90m 3[39m EH     Western â€¦ Africa    Africa    Northernâ€¦ Indeâ€¦</span></span>
<span id="cb3-13"><a href="geodata.html#cb3-13"></a><span class="co">#&gt; [90m 4[39m CA     Canada    North Amâ€¦ Americas  Northernâ€¦ Soveâ€¦</span></span>
<span id="cb3-14"><a href="geodata.html#cb3-14"></a><span class="co">#&gt; [90m 5[39m US     United Sâ€¦ North Amâ€¦ Americas  Northernâ€¦ Counâ€¦</span></span>
<span id="cb3-15"><a href="geodata.html#cb3-15"></a><span class="co">#&gt; [90m 6[39m KZ     Kazakhstâ€¦ Asia      Asia      Central â€¦ Soveâ€¦</span></span>
<span id="cb3-16"><a href="geodata.html#cb3-16"></a><span class="co">#&gt; [90m 7[39m UZ     Uzbekistâ€¦ Asia      Asia      Central â€¦ Soveâ€¦</span></span>
<span id="cb3-17"><a href="geodata.html#cb3-17"></a><span class="co">#&gt; [90m 8[39m PG     Papua Neâ€¦ Oceania   Oceania   Melanesia Soveâ€¦</span></span>
<span id="cb3-18"><a href="geodata.html#cb3-18"></a><span class="co">#&gt; [90m 9[39m ID     Indonesia Asia      Asia      South-Eaâ€¦ Soveâ€¦</span></span>
<span id="cb3-19"><a href="geodata.html#cb3-19"></a><span class="co">#&gt; [90m10[39m AR     Argentina South Amâ€¦ Americas  South Amâ€¦ Soveâ€¦</span></span>
<span id="cb3-20"><a href="geodata.html#cb3-20"></a><span class="co">#&gt; [90m# â€¦ with 167 more rows, and 5 more variables:[39m</span></span>
<span id="cb3-21"><a href="geodata.html#cb3-21"></a><span class="co">#&gt; [90m#   area_km2 [3m[90m&lt;dbl&gt;[90m[23m, pop [3m[90m&lt;dbl&gt;[90m[23m, lifeExp [3m[90m&lt;dbl&gt;[90m[23m,[39m</span></span>
<span id="cb3-22"><a href="geodata.html#cb3-22"></a><span class="co">#&gt; [90m#   gdpPercap [3m[90m&lt;dbl&gt;[90m[23m, geom [3m[90m&lt;MULTIPOLYGON [Â°]&gt;[90m[23m[39m</span></span></code></pre></div>
<p>The <code>x</code> object has MULTIPOLYGON geometry type, where each feature (row) can consist of one or more polygons.
Each polygonâ€™s vertices are represented by a pair of values (<code>dimension: XY</code>).
Bounding box allows to quickly understand the spatial extension of the input data.
<!--...-->
Finally, it has geographic CRS named WGS 84.
You can learn more about Coordinate Reference Systems in section <a href="geodata.html#crs">2.4</a>.
<!-- ref to CRS section --></p>
<p>Spatial vector data of class <code>sf</code> can be also obtained using some of other R data packages.
<!-- add REFs-->
For example, <strong>rnaturalearth</strong> allows to download world map data, <strong>osmdata</strong> imports OpenStreetMap data as <code>sf</code> objects, and <strong>tigris</strong> loads TIGER/Line data.
<!-- add reference to geocompr -->
<!-- add reference to https://cran.r-project.org/web/views/Spatial.html (after my updates) --></p>
<p>The <strong>tmap</strong> package accepts spatial vector data objects from both <strong>sf</strong> and <strong>sp</strong> packages.
In case of having vector objects in a different representation, they should be converted into <code>sf</code> objects first, before making maps.
The <strong>sf</strong> package has the <code>st_as_sf()</code> function that translates objects of many classes, including <code>Spatial</code> (from the <strong>sp</strong> package), <code>ppp</code>, <code>psp</code>, and <code>lpp</code> (from the <strong>spatstat</strong> package), to the objects of class <code>sf</code>.
The <code>st_as_sf()</code> function also allows to turn data frames into <code>sf</code> objects - the user needs to provide the input data frame, names of columns with coordinates, and additionally definition of the CRS of the data.
For example <code>my_sf = st_as_sf(my_df, coords = c("Xcolumn", "Ycolumn"), crs = 4326)</code>.</p>
<p>If you want to learn more about operating on <code>sf</code> objects, we recommend visiting the package website and vignettes at <a href="https://r-spatial.github.io/sf/index.html" class="uri">https://r-spatial.github.io/sf/index.html</a> and reading <a href="https://geocompr.github.io/">the Geocomputation with R book</a> <span class="citation">(Lovelace, Nowosad, and Muenchow <a href="#ref-lovelace2019geocomputation" role="doc-biblioref">2019</a>)</span>.
<!-- - vector simplification? --></p>
</div>
<div id="the-stars-package" class="section level3">
<h3><span class="header-section-number">2.3.2</span> The stars package</h3>
<p>
</p>
<!-- intro stars -->
<p>The <strong>stars</strong> package allows for reading and processing raster data in R.
This package also has support for both spatial vector and raster data cubes.
Its main class, <code>stars</code>, is built as a list of matrices or arrays with metadata describing their dimensions.
The <strong>stars</strong> package is also well integrated with <strong>sf</strong>, with many <code>st_</code> functions (such as <code>st_crs()</code>) working also on <code>stars</code> objects.</p>
<!-- - how to read stars objects from files -->
<p>The <code>read_stars()</code> function allow to read spatial raster data from a file<a href="#fn4" class="footnote-ref" id="fnref4"><sup>4</sup></a>.
This function requires at least one argument with a filename to be read.
<!--improve example--></p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="geodata.html#cb4-1"></a><span class="kw">library</span>(stars)</span>
<span id="cb4-2"><a href="geodata.html#cb4-2"></a>file_path2 =<span class="st"> </span><span class="kw">system.file</span>(<span class="st">&quot;raster/srtm.tif&quot;</span>, <span class="dt">package =</span> <span class="st">&quot;spDataLarge&quot;</span>)    </span>
<span id="cb4-3"><a href="geodata.html#cb4-3"></a>x2 =<span class="st"> </span><span class="kw">read_stars</span>(file_path2)</span></code></pre></div>
<p>The new object, <code>x2</code>, is of a <code>stars</code> class.
It has two dimensions, <code>x</code> and <code>y</code>, and one attribute <code>srtm.tif</code>.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="geodata.html#cb5-1"></a>x2</span>
<span id="cb5-2"><a href="geodata.html#cb5-2"></a><span class="co">#&gt; stars object with 2 dimensions and 1 attribute</span></span>
<span id="cb5-3"><a href="geodata.html#cb5-3"></a><span class="co">#&gt; attribute(s):</span></span>
<span id="cb5-4"><a href="geodata.html#cb5-4"></a><span class="co">#&gt;    srtm.tif    </span></span>
<span id="cb5-5"><a href="geodata.html#cb5-5"></a><span class="co">#&gt;  Min.   :1024  </span></span>
<span id="cb5-6"><a href="geodata.html#cb5-6"></a><span class="co">#&gt;  1st Qu.:1535  </span></span>
<span id="cb5-7"><a href="geodata.html#cb5-7"></a><span class="co">#&gt;  Median :1837  </span></span>
<span id="cb5-8"><a href="geodata.html#cb5-8"></a><span class="co">#&gt;  Mean   :1843  </span></span>
<span id="cb5-9"><a href="geodata.html#cb5-9"></a><span class="co">#&gt;  3rd Qu.:2114  </span></span>
<span id="cb5-10"><a href="geodata.html#cb5-10"></a><span class="co">#&gt;  Max.   :2892  </span></span>
<span id="cb5-11"><a href="geodata.html#cb5-11"></a><span class="co">#&gt; dimension(s):</span></span>
<span id="cb5-12"><a href="geodata.html#cb5-12"></a><span class="co">#&gt;   from  to  offset        delta refsys point values    </span></span>
<span id="cb5-13"><a href="geodata.html#cb5-13"></a><span class="co">#&gt; x    1 465 -113.24  0.000833333 WGS 84 FALSE   NULL [x]</span></span>
<span id="cb5-14"><a href="geodata.html#cb5-14"></a><span class="co">#&gt; y    1 457 37.5129 -0.000833333 WGS 84 FALSE   NULL [y]</span></span></code></pre></div>
<p>The <code>srtm.tif</code> attribute is a matrix, where each cell represents an elevation value.
The <code>x</code> dimension has 465 elements (columns), starting from a coordinate (<code>offset</code>) of a cell boundary of <code>-113.24</code>.
Next, the coordinates of further cells increase by <code>0.000833333</code> (<code>delta</code>) - resolution in the <code>x</code> dimension.
The <code>y</code> dimension has 457 elements (rows), starting from a coordinate (<code>offset</code>) of a cell boundary of <code>37.5129</code>.
For the <code>y</code> dimension, each further cellâ€™s coordinated decreases by <code>0.000833333</code> (notice the negative value of <code>delta</code>) - resolution in the <code>y</code> dimension.
Both dimensions also have the same CRS - <code>WGS 84</code>.</p>
<p><code>read_stars()</code> also has several additional arguments including <code>RasterIO</code>, which gives control over the input data extent and resolution.
For example, the below code will read just the first and second bands (results not shown).
<!-- - including reading chunks, changing resolution, and selecting bands -->
<!--improve example--></p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="geodata.html#cb6-1"></a>file_path3 =<span class="st"> </span><span class="kw">system.file</span>(<span class="st">&quot;raster/landsat.tif&quot;</span>, <span class="dt">package =</span> <span class="st">&quot;spDataLarge&quot;</span>)</span>
<span id="cb6-2"><a href="geodata.html#cb6-2"></a>x3 =<span class="st"> </span><span class="kw">read_stars</span>(file_path3, <span class="dt">RasterIO =</span> <span class="kw">list</span>(<span class="dt">bands =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">2</span>)))</span></code></pre></div>
<p>Internally, a <code>stars</code> object is a list of <code>matrix</code> or <code>array</code> objects with additional attributes describing spatial metadata, such as a number of columns and rows, resolution, coordinate reference system, etc.
All of this information is read from the input file.</p>
<p>Stars objects are constructed by dimensions and attributes.
Dimensions relate to what kind of objects are stored as list elements.
For example, when it is a <code>matrix</code> then we just have two dimensions representing columns and rows.
However, it is also possible to store multidimensional <code>array</code>s, which allow having many additional dimensions for bands, times, etc.
Attributes, on the other hand, are stored as list elements.
Each attribute can relate, for example to a different variable.</p>
<p>Reading a simple GeoTIFF file would result in having just two dimensions and one attribute (a <code>matrix</code>).
On the other hand, reading complex raster file formats, such as NetCDF could result in having more than two dimensions (e.g.Â time) and many attributes (e.g., an <code>array</code> with temperature, precipitation, humidity).
<!-- how it relates to mapping? --></p>
<!-- - stars proxy -->
<!-- more than 1e8 cells to read -->
<p>Before reading the file, the <strong>stars</strong> package checks if the input data is a curvilinear grid and what is the number of cells in the data.
When the input data is small or curvilinear then the full data is read in computer memory.
Otherwise, a <code>stars proxy</code> approach is used, where only metadata is read including pointers to where the complete data is.
When we want to plot large raster data, then it is read at a lower resolution than the native one.
<!-- ref to the section where we are explaining max.plot options --></p>
<p>The <strong>stars</strong> package also has support for vector data cubes, where each geometry is just stored once (as a dimension), and each attribute is a <code>matrix</code> or an <code>array</code> with the number of rows equals to the number of geometries, the number of columns equals to another dimension (e.g., time), and possibly the number of <code>array</code> layers equals for additional dimensions.
<!-- can we plot them in tmap? -->
<!-- if so - there should be an example in the book + reference --></p>
<!-- The **tmap** package accepts spatial raster data objects from both **stars** and **raster** packages. -->
<p>More information on how the <code>stars</code> objects are organized and how to operate on them can be found in the <strong>stars</strong> package vignettes at <a href="https://r-spatial.github.io/stars" class="uri">https://r-spatial.github.io/stars</a>.
<!-- - advice: sometimes/often it is better to prepare spatial object before the mapping, than trying to over-customize the map --></p>
</div>
</div>
<div id="crs" class="section level2">
<h2><span class="header-section-number">2.4</span> Map projections (CRS)</h2>
<!-- intro -->
<div id="what-are-map-projections" class="section level3">
<h3><span class="header-section-number">2.4.1</span> What are map projections?</h3>
<p>
We use maps so often in everyday life that most of us probably forget that a map is just a two-dimensional representation of a three-dimensional object, namely the earth.
For centuries, geographers and mathematicians wondered what the best way is to do this.
Let us wonder with them for a second.</p>
<p>The world is shown as an orange below, not just to stimulate your appetite for this subject, but also since an orange peel is a good analogy for a two-dimensional map.
A world map can be seen as an orange peel that is put flat on the table.
The question is how to do this.</p>
<div class="figure" style="text-align: center"><span id="fig:orange"></span>
<img src="images/orange_world.png" alt="How to peel an orange?" width="606" />
<p class="caption">
FIGURE 2.7: How to peel an orange?
</p>
</div>
<p>When we peel the orange, ideally we want to rip the peel near areas of the earth that are less interesting.
What is interesting depends on the application; for applications where land mass is more important than wetlands, it is a good idea to make the rips in the oceans.
The (interrupted) Goode homolosine projection, which is shown below, embodies this idea.
All continents and countries are preserved, except Antarctica and Greenland.
There is also a version of the Goode homolosine projection that focuses on preserving the oceans.</p>
<div class="figure" style="text-align: center"><span id="fig:crs-goode"></span>
<img src="02-geodata_files/figure-html/crs-goode-1.png" alt="The (interrupted) Goode homolosine projection" width="672" />
<p class="caption">
FIGURE 2.8: The (interrupted) Goode homolosine projection
</p>
</div>
<p>To make the analogy between the orange peel and the surface of the earth complete, we have to assign two fictitious properties to the orange peel, namely that it is stretchable and deformable.
These properties are needed in order to make a non-interrupted map, as we will see in the next sections.</p>
<p>

A method to flatten down the earth, for which the Goode homolosine projection shown Figure <a href="geodata.html#fig:crs-goode">2.8</a> is an example, is called a <em>map projection</em>.
Technically, it is also known as a <em>coordinate reference system</em> (<em>CRS</em>), which specifies the corresponding coordinate system, as well as the transformations to other map projections.</p>
</div>
<div id="a-model-of-the-earth" class="section level3">
<h3><span class="header-section-number">2.4.2</span> A model of the Earth</h3>
<p>
<!--we should use either "Earth" or "earth" (both are right now in the text)-->
The orange and the Earth have another thing in common; both are spheres, but not perfect ones.
The Earth is metaphorically speaking a little fat: the circumference around the equator is 40,075 km whereas around the circumference that crosses both poles is 40,009 km.
<!--source: https://en.wikipedia.org/wiki/Earth_physical_characteristics_tables-->
Therefore, the earth can better be described as an ellipsoid.
The same applies to an orange; every orange is a little different, but probably very few oranges are perfect spheres.</p>
<p>Although the ellipsoid is a good mathematical model to describe the earthâ€™s surface, keep in mind that the surface of the earth is not smooth;
land mass usually lies on a higher altitude than sea level.
We could potentially map each point on the surface of the earth using a three-dimensional <span class="math inline">\((x, y, z)\)</span> Cartesian coordinate system with the center of the mass of the Earth being the origin (0, 0, 0).
However, since this has many mathematical complications, the ellipsoid is often sufficient as a model of the surface of the earth.</p>
<p>
This ellipsoid model and its translation to the Earthâ€™ surface is called a <em>(geodetic) datum</em>.
The most popular datum is WGS84, which has been introduced in 1984 as an international standard, and has been last revised in 2004.
There are many (slightly) different datums, which are often tailored for local applications.
For instance, NAD83, ETRS89, and GDA94 are slightly better models for North-America, Europe, and Australia respectively.
However, since WGS84 is a very good approximation of the earth as a whole, it has been widely adopted worldwide and is also used by the Global Positioning System (GPS).</p>
<p>
When we have specified a datum, we are able to specify geographic locations with two familiar variables, namely <em>latitude</em> and <em>longitude</em>.
The latitude specifies the north-south position in degrees, where latitude = 0<span class="math inline">\(^\circ\)</span> is the equator.
The latitudes for the north and south pole are 90<span class="math inline">\(^\circ\)</span> and <span class="math inline">\(-90^\circ\)</span> respectively.
The longitude specifies the east-west position in degrees, where by convention, the longitude = 0<span class="math inline">\(^\circ\)</span> meridian crosses the Royal Observatory in Greenwich, UK.
The Longitude range is -180<span class="math inline">\(^\circ\)</span> to 180<span class="math inline">\(^\circ\)</span>, and since this is a full circle, -180<span class="math inline">\(^\circ\)</span> and <span class="math inline">\(^\circ\)</span> specify the same longitude.</p>
<p>
When we see the earth in its three-dimensional form, as in Figure <a href="geodata.html#fig:orange">2.7</a>, the latitude parallels are the horizontal lines around the earth, and the longitude meridians are the vertical lines around the earth.
The set of longitude meridians and latitude parallels is also referred to as <em>graticule</em>.
In all the figures in this section, latitude parallels are shown as gray lines for <span class="math inline">\(-60^\circ\)</span>, <span class="math inline">\(-30^\circ\)</span>, <span class="math inline">\(0^\circ\)</span>, <span class="math inline">\(30^\circ\)</span> and <span class="math inline">\(60^\circ\)</span>, and longitude meridians from <span class="math inline">\(-180^\circ\)</span> to <span class="math inline">\(180^\circ\)</span> at every <span class="math inline">\(30^\circ\)</span>.</p>
<p>Please keep in mind that only a latitude and longitude are not sufficient to specify a geographic location.
A datum is required.
When people exchange latitude-longitude data, it is safe to assume that they implicitly have used the WGS84 datum.
However, it is good practice to specify the datum explicitly.</p>
</div>
<div id="platte-carrÃ©e-and-web-mercator" class="section level3">
<h3><span class="header-section-number">2.4.3</span> Platte CarrÃ©e and Web Mercator</h3>
<p>

Letâ€™s take a closer look at two widely used map projections, namely the plain latitude-longitude coordinate system (using the WGS84 datum) and the Web Mercator projection, which is currently the de facto standard for interactive maps.
These projections are indexed as EPSG4326 and EPSG3857 respectively.
EPSG is an institute that maintains a database of standard map projections.</p>
<!--https://geographx.co.nz/map-projections/-->
<div class="figure" style="text-align: center"><span id="fig:crs-04"></span>
<img src="02-geodata_files/figure-html/crs-04-1.png" alt="The WGS84 coordinate system (EPSG4326)" width="672" />
<p class="caption">
FIGURE 2.9: The WGS84 coordinate system (EPSG4326)
</p>
</div>
<p>When we fictitiously make little holes in the orange peel at both poles, and stretch these open so wide that they have the same width as the equator, we obtain the cylinder depicted in Figure <a href="geodata.html#fig:crs-04">2.9</a> (left).
Note that the longitude lines have become straight vertical lines.
When we unroll this cylinder, we obtain a map where the <span class="math inline">\(x\)</span> and <span class="math inline">\(y\)</span> coordinates are the longitude and latitude respectively.
This CRS, which is known as EPSG4326, is shown in Figure <a href="geodata.html#fig:crs-04">2.9</a> (right).</p>
<p>


EPSG4326 is an <em>unprojected</em> CRS, since the longitude and latitude have not been transformed.
With <em>projected</em> CRSs, the <span class="math inline">\(x\)</span> and <span class="math inline">\(y\)</span> coordinates refer to specific measurement units, usually meters.
The projected variant of this CRS is called the <em>Platte CarrÃ©e</em> (EPSG4087), and is exactly the same map as shown in Figure <a href="geodata.html#fig:crs-04">2.9</a> (right), but with other <span class="math inline">\(x\)</span> and <span class="math inline">\(y\)</span> value ranges.</p>
<p>Observe since we stretched the poles open, the area near the poles have been stretched out as well.
More specifically, the closer the land is to one of the poles, the more it has been stretched out.
Since the stretching direction is only horizontally, the shapes of the areas have become wider.
A good example is Greenland, which is normally a â€˜tallâ€™ area (as can be seen in Figure <a href="geodata.html#fig:orange">2.7</a>).</p>
<p>
In order to fix these deformed areas, Gerardus Mercator, a Flemish geographer in the 16th century introduced a method to compensate for this by inflating the areas near the poles even more, but now only in a vertical direction.
This projection is called the Mercator projection.
For web applications, this projection has been slightly modified and renamed to the Web Mercator projection (EPSG3857).
The cylinder and plain map that uses this projection are shown in Figure <a href="geodata.html#fig:crs-05">2.10</a>.</p>
<div class="figure" style="text-align: center"><span id="fig:crs-05"></span>
<img src="02-geodata_files/figure-html/crs-05-1.png" alt="Web Mercator projection (EPSG3857)" width="672" />
<p class="caption">
FIGURE 2.10: Web Mercator projection (EPSG3857)
</p>
</div>
<p>Although the areas near the poles have been inflated quite a lot, especially Antarctica and Greenland, the shape of the areas is more or less correct, in particular regarding small areas (which can be seen by comparing with Figure <a href="geodata.html#fig:orange">2.7</a>).
The Mercator projection is very useful for navigational purposes, and has therefore been embraced by sailors ever since.
Also today, the Web Mercator is the de facto standard for interactive maps and navigation services.
However, for maps that show data the (Web) Mercator projection should be used with great caution, because the hugely inflated areas will influence how we perceive spatial data.
We will discuss this in the next section.</p>
</div>
<div id="types-of-map-projections" class="section level3">
<h3><span class="header-section-number">2.4.4</span> Types of map projections</h3>
<!-- https://en.wikipedia.org/wiki/List_of_map_projections
http://www.geog.uoregon.edu/shinker/geog311/Labs/lab02/properties.htm
https://www.researchgate.net/publication/303311220_Projection_Wizard_-_An_Online_Map_Projection_Selection_Tool
https://projectionwizard.org/
https://kartoweb.itc.nl/geometrics/Map%20projections/body.htm
http://www.geo.hunter.cuny.edu/~jochen/gtech201/lectures/lec6concepts/map%20coordinate%20systems/how%20to%20choose%20a%20projection.htm
https://books.google.nl/books?id=E0JZDwAAQBAJ&pg=PA244&lpg=PA244&dq=Equidistant+projections+important&source=bl&ots=UqDt0ZBgEP&sig=ACfU3U3R1XN0i33v6Izh8fQZGJbpLF9ULw&hl=en&sa=X&ved=2ahUKEwi84tT_68rqAhUQ26QKHRcWD3AQ6AEwEHoECAgQAQ#v=onepage&q=Equidistant%20projections%20important&f=false
-->
<p>
Let us go back to the original question: how can we make a two-dimensional image of our three-dimensional earth?
Although there are many ways, four basic map projection types can be distinguished.
These are depicted in Figure <a href="geodata.html#fig:crs-types">2.11</a>.</p>
<div class="figure" style="text-align: center"><span id="fig:crs-types"></span>
<img src="02-geodata_files/figure-html/crs-types-1.png" alt="Four types of map projections" width="100%" />
<p class="caption">
FIGURE 2.11: Four types of map projections
</p>
</div>
<p>
Examples for cylindrical projections have already been given in the previous section; both Platte CarrÃ©e and Web-Mercator are cylindrical.
Another widely used cylindrical map projection is the <em>Universal Transverse Mercator (UTM)</em>.
The cylinder is not placed upright, but horizontal.
There are 60 positions in which this cylinder can be placed, where in each position, the cylinder faces a longitude range of 6 degrees.
In other words the UTM is not a single projection, but a series of 60 projections.</p>
<p>There are many projections which are pseudo-cylinders in the sense that the radius around the poles is smaller than around the equator.
An example is the Robinson projection shown in Figure <a href="geodata.html#fig:crs-robin">2.12</a>.
Almost all commonly used standard World map projections are (pseudo-)cylindrical.</p>
<div class="figure" style="text-align: center"><span id="fig:crs-robin"></span>
<img src="02-geodata_files/figure-html/crs-robin-1.png" alt="The Robinson projection, which is pseudo-cylindrical." width="100%" />
<p class="caption">
FIGURE 2.12: The Robinson projection, which is pseudo-cylindrical.
</p>
</div>
<p>
An example of a conic map projection is shown in <a href="geodata.html#fig:crs-conic-planar">2.13</a>(a).
As a result of unfolding a cone on a flat surface, a gap is created.
The size (angle) of this gap depends on the width of the cone.
There are also pseudo-conic map projections in which some meridians (longitude lines) are curved.
Conic map projections are useful for mid-latitude areas where the surfaces of the earth and the cone are almost parallel to each other.</p>
<p>
Planar map projections, also known as azimuthal projections, project the Earth on a disk.
This can be done in several ways.
This can best be explained by the position of an imaginary light source.
It can be placed inside the globe, at the surface of the globe opposite to the disk, and at an infinite distance opposite to the disk.
The corresponding families of projections are called gnomonic, stereographic, and orthogonal projections.</p>
<p>Planar map projections are often used for a specific country or continent.
An example is the Lambert Azimuthal Equal-Area projection (EPSG3035), shown in <a href="geodata.html#fig:crs-conic-planar">2.13</a>(b), which is optimized for Europe.
It can be classified as a stereographic projection, although the light beams are not straight but curved.
Another example of a planar map projection is the orange shown in Figure <a href="geodata.html#fig:orange">2.7</a>.
This is an orthogonal projection.</p>
<div class="figure" style="text-align: center"><span id="fig:crs-conic-planar"></span>
<img src="02-geodata_files/figure-html/crs-conic-planar-1.png" alt="Examples of a conic (a) and a planar (b) projection." width="672" />
<p class="caption">
FIGURE 2.13: Examples of a conic (a) and a planar (b) projection.
</p>
</div>
<p>
The (interrupted) Goode homolosine projection shown in Figure <a href="geodata.html#fig:crs-goode">2.8</a> is an example of an interrupted projection.
A special class of these projections are polyhedral projections, which consists of planar faces.
In Figure <a href="geodata.html#fig:crs-types">2.11</a> a polyhedral of six faces is illustrated.
There is no limit of the number of faces, as the myriahedral projections (TODO reference Van Wijck paper) illustrate.</p>
</div>
<div id="which-projection-to-choose" class="section level3">
<h3><span class="header-section-number">2.4.5</span> Which projection to choose?</h3>
<p>
Hopefully it is clear that there is no perfect projection, since each projection has its pros and cons.
Whether a projection is good for a certain application, depends on two factors.
The first factor is the type of application and in particular which map projection properties are useful or even required for that application.
For instance, navigation requires other map projection properties than statistical maps.
The second factor is the area of interest.
Is the whole World visualized or only a part, and in the latter case, which part?
In this section, guidelines are provided to choose a proper projection based on those two aspects.</p>
<p>Before we go deeper into selecting a projection, it is worth noting that for many countries and continents, government agencies already have chosen projections to be the standard for mapping spatial data.
For instance, a standard for Europe, which is used by Eurostat (the statistical agency of the European Union), is the Lambert Azimuthal Equal-Area projection shown in Figure <a href="geodata.html#fig:crs-conic-planar">2.13</a>(b).
If the area of interest has such a standard, it is recommended to use it, because it can be safely assumed that this standard is a proper projection, and moreover, it makes cooperation and communication with other parties easier.
However, be aware of the limitations that this particular projection may have, and that there may be better alternatives out there.</p>
<p><strong>Map projection properties</strong></p>
<p>
The type of application is important for the choice of a map projection.
However, it would be quite tedious to list all possible applications and provide projection recommendations for each of them.
Instead, we focus on four map projection properties.
The key step is to find out which of these properties are useful or even required for the target application.
The four properties are listed in the following table.</p>
<table class="table" style="font-size: 12px; margin-left: auto; margin-right: auto;">
<caption style="font-size: initial !important;">
<span id="tab:crs-properties">TABLE 2.1: </span>Map projection properties.
</caption>
<tbody>
<tr>
<td style="text-align:left;width: 14em; font-weight: bold;">
Property
</td>
<td style="text-align:left;">
Conformal
</td>
<td style="text-align:left;width: 14em; ">
Equal area
</td>
<td style="text-align:left;">
Equidistant
</td>
<td style="text-align:left;width: 14em; ">
Azimuthal
</td>
</tr>
<tr>
<td style="text-align:left;width: 14em; font-weight: bold;">
Preserves
</td>
<td style="text-align:left;">
Local angle (shape)
</td>
<td style="text-align:left;width: 14em; ">
Area
</td>
<td style="text-align:left;">
Distance
</td>
<td style="text-align:left;width: 14em; ">
Direction
</td>
</tr>
<tr>
<td style="text-align:left;width: 14em; font-weight: bold;">
Applications
</td>
<td style="text-align:left;">
Navigation, climate
</td>
<td style="text-align:left;width: 14em; ">
Statistics
</td>
<td style="text-align:left;">
Geology
</td>
<td style="text-align:left;width: 14em; ">
Geology
</td>
</tr>
<tr>
<td style="text-align:left;width: 14em; font-weight: bold;">
Examples (cyclindrical)
</td>
<td style="text-align:left;">
Mercator
</td>
<td style="text-align:left;width: 14em; ">
Gall-Peters, Eckert IV
</td>
<td style="text-align:left;">
Equirectangular
</td>
<td style="text-align:left;width: 14em; ">
none
</td>
</tr>
<tr>
<td style="text-align:left;width: 14em; font-weight: bold;">
Examples (conic)
</td>
<td style="text-align:left;">
Lambert conformal conic
</td>
<td style="text-align:left;width: 14em; ">
Albers conic
</td>
<td style="text-align:left;">
Equidistant conic
</td>
<td style="text-align:left;width: 14em; ">
none
</td>
</tr>
<tr>
<td style="text-align:left;width: 14em; font-weight: bold;">
Examples (planar)
</td>
<td style="text-align:left;">
Stereographic
</td>
<td style="text-align:left;width: 14em; ">
Lambert azimuthal equal-area
</td>
<td style="text-align:left;">
Azimuthal equidistant
</td>
<td style="text-align:left;width: 14em; ">
Stereographic, Lambert azimuthal equal-area
</td>
</tr>
<tr>
<td style="text-align:left;width: 14em; font-weight: bold;">
Examples (interrupted)
</td>
<td style="text-align:left;">
Myriahedral
</td>
<td style="text-align:left;width: 14em; ">
Goode homolosine, Myriahedral
</td>
<td style="text-align:left;">
none
</td>
<td style="text-align:left;width: 14em; ">
none
</td>
</tr>
</tbody>
</table>
<p>
A <em>conformal</em> projection means that local angles are preserved.
In practice, that means that for instance a map of a crossroad preserves the angles between the roads.
Therefore, this property is required for navigational purposes.
As a consequence that local angles are preserved, local shapes are also preserved.
That means that an small island will be drawn on a map in its true shape, as seen from the sky perpendicular above it.
The Web Mercator shown in Figure <a href="geodata.html#fig:crs-05">2.10</a> satisfies this property; the closer an area is to one of the poles, the more it is enlarged, but since this is done in both dimensions (latitude and longitude), local shapes are preserved.</p>
<p>
A map projection is called <em>equal-area</em> if the areas are proportional to the true areas.
This is strongly recommended for maps that show statistics in order to prevent perceptual bias.
Figure <a href="geodata.html#fig:crs-bias">2.14</a> shows two World maps of population density per country, one in the Web Mercator projection and the other in Eckert IV projection.
The perception of World population is different in these maps; in (a) the vast lands on low-populated areas seem to be Canada, Greenland, and Russia, whereas in (b) also North Africa and Australia emerge as vast low-populated areas.</p>
<div class="figure" style="text-align: center"><span id="fig:crs-bias"></span>
<img src="02-geodata_files/figure-html/crs-bias-1.png" alt="The Robinson projection, which is pseudo-cylindrical." width="100%" />
<p class="caption">
FIGURE 2.14: The Robinson projection, which is pseudo-cylindrical.
</p>
</div>
<p>

The other two map projection properties are related to one central point on the map.
A map projection is called <em>equidistant</em> if the distances to any other point in the map are preserved, and <em>azimuthal</em> if the directions to any other point are preserved.
These properties are in particular useful in the field of geology.
One example is a seismic map around the epicenter of a recent earthquake, where it is important to how far and in which direction the vibrations are spreading.</p>
<p>
A map projection can satisfy at most two of these properties.
Many map projection do not satisfy any property but are intended as a compromise.
An example is the Robinson projection, shown in Figure <a href="geodata.html#fig:crs-robin">2.12</a>.</p>
<p><strong>Area of interest</strong></p>
<p>
The next aspect that is important for the choice of a map projection is the area of interest.
In general, the larger the area, the more concessions have to be made, since the larger the area, the more difficult it is to make a two-dimensional projection.</p>
<p>The following table provides recommendations of map projection types based on the area size and on the latitude of the area.</p>
<table class="table" style="font-size: 12px; margin-left: auto; margin-right: auto;">
<caption style="font-size: initial !important;">
<span id="tab:crs-recommendations">TABLE 2.2: </span>Recommended projections.
</caption>
<thead>
<tr>
<th style="text-align:left;">
View
</th>
<th style="text-align:left;">
Low latitude (equator)
</th>
<th style="text-align:left;">
Mid latitude
</th>
<th style="text-align:left;">
High latitude (poles)
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;width: 10em; ">
World
</td>
<td style="text-align:left;">
Pseudo-cylindrical
</td>
<td style="text-align:left;">
Pseudo-cylindrical
</td>
<td style="text-align:left;">
Pseudo-cylindrical
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; ">
Hemisphere
</td>
<td style="text-align:left;">
Azimuthal
</td>
<td style="text-align:left;">
Azimuthal
</td>
<td style="text-align:left;">
Azimuthal
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; ">
Continent or smaller
</td>
<td style="text-align:left;">
Cylindrical or azimuthal
</td>
<td style="text-align:left;">
Conic or azimuthal
</td>
<td style="text-align:left;">
Azimuthal
</td>
</tr>
</tbody>
</table>
<p>For World maps, pseudo-cylindrical map projections, such as the Robinson projection (Figure <a href="geodata.html#fig:crs-robin">2.12</a>) and the Eckert IV projection (Figure <a href="geodata.html#fig:crs-bias">2.14</a>(b)) are very popular because they have less distortion other map projections.
For areas that cover a half of the sphere, i.e.Â a hemisphere, azimuthal map projections are recommended.
There are four hemispheres that are often used: the Northern and Southern Hemisphere, with respectively the North and South Pole as center, the Western Hemisphere consisting of the Americas, and the Eastern Hemisphere, which includes the other continents.
However, other hemispheres are often used implicitly, such as a hemisphere centered on Europe used in the Lambert Azimuthal Equal-Area projection shown in Figure <a href="geodata.html#fig:crs-conic-planar">2.13</a>(b).</p>
<p>For areas with the size of a continent or country, the azimuthal map projection type can be used when centered on the area of interest.
In particular, the Lambert Azimuthal Equal-Area projection when equal area is required, and the Azimuthal Equidistant projection when preserving distances is important.
Alternatively, cylindrical and conic map projection types can be used for areas at low and mid latitudes respectively.
Another alternative is to use a UTM projection.
However, this is only recommended when the target area spans less than 6 degrees longitude.<!--and do not cross the UTM zone lines--></p>
</div>
<div id="crs-in-r" class="section level3">
<h3><span class="header-section-number">2.4.6</span> CRS in R</h3>
<p>

Coordinate Reference Systems (CRSs) are implemented in the software library <a href="https://proj.org/"><strong>PROJ</strong></a>.
With implementation, we mean specifying a CRS and transforming coordinates from one CRS to another.
<strong>PROJ</strong> is used by every popular software application for spatial data, in particular <strong>ArcGIS</strong>, <strong>QGIS</strong>, and <strong>GRASS</strong>, and also by many programming languages, including R.
The <strong>sf</strong> package integrates the <strong>PROJ</strong> functions into R.</p>
<p>A CRS is represented in R by an object of class <code>crs</code>, which can be retrieved or set with the function <code>st_crs</code> (from the <strong>sf</strong> package).
In the following example, a <code>crs</code> object is created from an EPSG code, in this case 3035, the Lambert Azimuthal Equal-Area projection for Europe.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="geodata.html#cb7-1"></a><span class="kw">library</span>(sf)</span>
<span id="cb7-2"><a href="geodata.html#cb7-2"></a></span>
<span id="cb7-3"><a href="geodata.html#cb7-3"></a><span class="co"># CRS Lambert Azimuthal Equal-Area projection</span></span>
<span id="cb7-4"><a href="geodata.html#cb7-4"></a><span class="kw">st_crs</span>(<span class="dv">3035</span>)</span>
<span id="cb7-5"><a href="geodata.html#cb7-5"></a><span class="co">#&gt; Coordinate Reference System:</span></span>
<span id="cb7-6"><a href="geodata.html#cb7-6"></a><span class="co">#&gt;   User input: EPSG:3035 </span></span>
<span id="cb7-7"><a href="geodata.html#cb7-7"></a><span class="co">#&gt;   wkt:</span></span>
<span id="cb7-8"><a href="geodata.html#cb7-8"></a><span class="co">#&gt; PROJCRS[&quot;ETRS89-extended / LAEA Europe&quot;,</span></span>
<span id="cb7-9"><a href="geodata.html#cb7-9"></a><span class="co">#&gt;     BASEGEOGCRS[&quot;ETRS89&quot;,</span></span>
<span id="cb7-10"><a href="geodata.html#cb7-10"></a><span class="co">#&gt;         DATUM[&quot;European Terrestrial Reference System 1989&quot;,</span></span>
<span id="cb7-11"><a href="geodata.html#cb7-11"></a><span class="co">#&gt;             ELLIPSOID[&quot;GRS 1980&quot;,6378137,298.257222101,</span></span>
<span id="cb7-12"><a href="geodata.html#cb7-12"></a><span class="co">#&gt;                 LENGTHUNIT[&quot;metre&quot;,1]]],</span></span>
<span id="cb7-13"><a href="geodata.html#cb7-13"></a><span class="co">#&gt;         PRIMEM[&quot;Greenwich&quot;,0,</span></span>
<span id="cb7-14"><a href="geodata.html#cb7-14"></a><span class="co">#&gt;             ANGLEUNIT[&quot;degree&quot;,0.0174532925199433]],</span></span>
<span id="cb7-15"><a href="geodata.html#cb7-15"></a><span class="co">#&gt;         ID[&quot;EPSG&quot;,4258]],</span></span>
<span id="cb7-16"><a href="geodata.html#cb7-16"></a><span class="co">#&gt;     CONVERSION[&quot;Europe Equal Area 2001&quot;,</span></span>
<span id="cb7-17"><a href="geodata.html#cb7-17"></a><span class="co">#&gt;         METHOD[&quot;Lambert Azimuthal Equal Area&quot;,</span></span>
<span id="cb7-18"><a href="geodata.html#cb7-18"></a><span class="co">#&gt;             ID[&quot;EPSG&quot;,9820]],</span></span>
<span id="cb7-19"><a href="geodata.html#cb7-19"></a><span class="co">#&gt;         PARAMETER[&quot;Latitude of natural origin&quot;,52,</span></span>
<span id="cb7-20"><a href="geodata.html#cb7-20"></a><span class="co">#&gt;             ANGLEUNIT[&quot;degree&quot;,0.0174532925199433],</span></span>
<span id="cb7-21"><a href="geodata.html#cb7-21"></a><span class="co">#&gt;             ID[&quot;EPSG&quot;,8801]],</span></span>
<span id="cb7-22"><a href="geodata.html#cb7-22"></a><span class="co">#&gt;         PARAMETER[&quot;Longitude of natural origin&quot;,10,</span></span>
<span id="cb7-23"><a href="geodata.html#cb7-23"></a><span class="co">#&gt;             ANGLEUNIT[&quot;degree&quot;,0.0174532925199433],</span></span>
<span id="cb7-24"><a href="geodata.html#cb7-24"></a><span class="co">#&gt;             ID[&quot;EPSG&quot;,8802]],</span></span>
<span id="cb7-25"><a href="geodata.html#cb7-25"></a><span class="co">#&gt;         PARAMETER[&quot;False easting&quot;,4321000,</span></span>
<span id="cb7-26"><a href="geodata.html#cb7-26"></a><span class="co">#&gt;             LENGTHUNIT[&quot;metre&quot;,1],</span></span>
<span id="cb7-27"><a href="geodata.html#cb7-27"></a><span class="co">#&gt;             ID[&quot;EPSG&quot;,8806]],</span></span>
<span id="cb7-28"><a href="geodata.html#cb7-28"></a><span class="co">#&gt;         PARAMETER[&quot;False northing&quot;,3210000,</span></span>
<span id="cb7-29"><a href="geodata.html#cb7-29"></a><span class="co">#&gt;             LENGTHUNIT[&quot;metre&quot;,1],</span></span>
<span id="cb7-30"><a href="geodata.html#cb7-30"></a><span class="co">#&gt;             ID[&quot;EPSG&quot;,8807]]],</span></span>
<span id="cb7-31"><a href="geodata.html#cb7-31"></a><span class="co">#&gt;     CS[Cartesian,2],</span></span>
<span id="cb7-32"><a href="geodata.html#cb7-32"></a><span class="co">#&gt;         AXIS[&quot;northing (Y)&quot;,north,</span></span>
<span id="cb7-33"><a href="geodata.html#cb7-33"></a><span class="co">#&gt;             ORDER[1],</span></span>
<span id="cb7-34"><a href="geodata.html#cb7-34"></a><span class="co">#&gt;             LENGTHUNIT[&quot;metre&quot;,1]],</span></span>
<span id="cb7-35"><a href="geodata.html#cb7-35"></a><span class="co">#&gt;         AXIS[&quot;easting (X)&quot;,east,</span></span>
<span id="cb7-36"><a href="geodata.html#cb7-36"></a><span class="co">#&gt;             ORDER[2],</span></span>
<span id="cb7-37"><a href="geodata.html#cb7-37"></a><span class="co">#&gt;             LENGTHUNIT[&quot;metre&quot;,1]],</span></span>
<span id="cb7-38"><a href="geodata.html#cb7-38"></a><span class="co">#&gt;     USAGE[</span></span>
<span id="cb7-39"><a href="geodata.html#cb7-39"></a><span class="co">#&gt;         SCOPE[&quot;unknown&quot;],</span></span>
<span id="cb7-40"><a href="geodata.html#cb7-40"></a><span class="co">#&gt;         AREA[&quot;Europe - LCC &amp; LAEA&quot;],</span></span>
<span id="cb7-41"><a href="geodata.html#cb7-41"></a><span class="co">#&gt;         BBOX[24.6,-35.58,84.17,44.83]],</span></span>
<span id="cb7-42"><a href="geodata.html#cb7-42"></a><span class="co">#&gt;     ID[&quot;EPSG&quot;,3035]]</span></span></code></pre></div>
<p>
A <code>crs</code> object is represented by Well Known Text (WKT).
It includes a specification of the used datum as well as information how to transform it into other CRSs.
Understanding the exact content of the WTK is not important for most users, since it is not needed to write a WKT yourself.</p>
<p>


A <code>crs</code> object can be created in three ways:</p>
<ol style="list-style-type: decimal">
<li>The first is with an EPSG number as user input specification as shown above.</li>
<li>The second is also with a user input specification, but with a so-called <em>proj4</em> character string.
The <em>proj4</em> character string for the LAEA projection is <code>"+proj=laea +lat_0=52 +lon_0=10 +x_0=4321000 +y_0=3210000 +ellps=GRS80 +units=m +no_defs"</code>.
However, <em>proj4</em> character strings should be used with caution since they often lack important CRS information regarding datums and CRS transformations.
Also note that the name <em>proj4</em> stands for the <strong>PROJ</strong> library version 4, while the current major version of <strong>PROJ</strong> at the time of writing is already 7.</li>
<li>The third way to create a <code>crs</code> object is to extract it from an existing spatial data object (e.g.Â an <strong>sf</strong> or <strong>stars</strong> object).</li>
</ol>
<p>A <code>crs</code> object can be used to define a new spatial object or to transform an existing spatial object into another projection.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="geodata.html#cb8-1"></a><span class="co"># create a data.frame of three famous waterfalls</span></span>
<span id="cb8-2"><a href="geodata.html#cb8-2"></a>waterfalls =<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">name =</span> <span class="kw">c</span>(<span class="st">&quot;Iguazu Falls&quot;</span>, <span class="st">&quot;Niagara Falls&quot;</span>, <span class="st">&quot;Victoria Falls&quot;</span>), </span>
<span id="cb8-3"><a href="geodata.html#cb8-3"></a>                        <span class="dt">lat =</span> <span class="kw">c</span>(<span class="op">-</span><span class="fl">25.686785</span>, <span class="fl">43.092461</span>, <span class="fl">-17.931805</span>), </span>
<span id="cb8-4"><a href="geodata.html#cb8-4"></a>                        <span class="dt">lon =</span> <span class="kw">c</span>(<span class="op">-</span><span class="fl">54.444981</span>, <span class="fl">-79.047150</span>, <span class="fl">25.825558</span>))</span>
<span id="cb8-5"><a href="geodata.html#cb8-5"></a></span>
<span id="cb8-6"><a href="geodata.html#cb8-6"></a><span class="co"># create sf object (without specifying the crs)</span></span>
<span id="cb8-7"><a href="geodata.html#cb8-7"></a>waterfalls_sf =<span class="st"> </span><span class="kw">st_as_sf</span>(waterfalls, <span class="dt">coords =</span> <span class="kw">c</span>(<span class="st">&quot;lon&quot;</span>, <span class="st">&quot;lat&quot;</span>))</span>
<span id="cb8-8"><a href="geodata.html#cb8-8"></a></span>
<span id="cb8-9"><a href="geodata.html#cb8-9"></a><span class="co"># extract crs (not defined yet)</span></span>
<span id="cb8-10"><a href="geodata.html#cb8-10"></a><span class="kw">st_crs</span>(waterfalls_sf)</span>
<span id="cb8-11"><a href="geodata.html#cb8-11"></a><span class="co">#&gt; Coordinate Reference System: NA</span></span>
<span id="cb8-12"><a href="geodata.html#cb8-12"></a></span>
<span id="cb8-13"><a href="geodata.html#cb8-13"></a><span class="co"># specify crs</span></span>
<span id="cb8-14"><a href="geodata.html#cb8-14"></a><span class="kw">st_crs</span>(waterfalls_sf) =<span class="st"> </span><span class="dv">4326</span></span>
<span id="cb8-15"><a href="geodata.html#cb8-15"></a></span>
<span id="cb8-16"><a href="geodata.html#cb8-16"></a><span class="co"># extract crs</span></span>
<span id="cb8-17"><a href="geodata.html#cb8-17"></a><span class="kw">st_crs</span>(waterfalls_sf)</span>
<span id="cb8-18"><a href="geodata.html#cb8-18"></a><span class="co">#&gt; Coordinate Reference System:</span></span>
<span id="cb8-19"><a href="geodata.html#cb8-19"></a><span class="co">#&gt;   User input: EPSG:4326 </span></span>
<span id="cb8-20"><a href="geodata.html#cb8-20"></a><span class="co">#&gt;   wkt:</span></span>
<span id="cb8-21"><a href="geodata.html#cb8-21"></a><span class="co">#&gt; GEOGCRS[&quot;WGS 84&quot;,</span></span>
<span id="cb8-22"><a href="geodata.html#cb8-22"></a><span class="co">#&gt;     DATUM[&quot;World Geodetic System 1984&quot;,</span></span>
<span id="cb8-23"><a href="geodata.html#cb8-23"></a><span class="co">#&gt;         ELLIPSOID[&quot;WGS 84&quot;,6378137,298.257223563,</span></span>
<span id="cb8-24"><a href="geodata.html#cb8-24"></a><span class="co">#&gt;             LENGTHUNIT[&quot;metre&quot;,1]]],</span></span>
<span id="cb8-25"><a href="geodata.html#cb8-25"></a><span class="co">#&gt;     PRIMEM[&quot;Greenwich&quot;,0,</span></span>
<span id="cb8-26"><a href="geodata.html#cb8-26"></a><span class="co">#&gt;         ANGLEUNIT[&quot;degree&quot;,0.0174532925199433]],</span></span>
<span id="cb8-27"><a href="geodata.html#cb8-27"></a><span class="co">#&gt;     CS[ellipsoidal,2],</span></span>
<span id="cb8-28"><a href="geodata.html#cb8-28"></a><span class="co">#&gt;         AXIS[&quot;geodetic latitude (Lat)&quot;,north,</span></span>
<span id="cb8-29"><a href="geodata.html#cb8-29"></a><span class="co">#&gt;             ORDER[1],</span></span>
<span id="cb8-30"><a href="geodata.html#cb8-30"></a><span class="co">#&gt;             ANGLEUNIT[&quot;degree&quot;,0.0174532925199433]],</span></span>
<span id="cb8-31"><a href="geodata.html#cb8-31"></a><span class="co">#&gt;         AXIS[&quot;geodetic longitude (Lon)&quot;,east,</span></span>
<span id="cb8-32"><a href="geodata.html#cb8-32"></a><span class="co">#&gt;             ORDER[2],</span></span>
<span id="cb8-33"><a href="geodata.html#cb8-33"></a><span class="co">#&gt;             ANGLEUNIT[&quot;degree&quot;,0.0174532925199433]],</span></span>
<span id="cb8-34"><a href="geodata.html#cb8-34"></a><span class="co">#&gt;     USAGE[</span></span>
<span id="cb8-35"><a href="geodata.html#cb8-35"></a><span class="co">#&gt;         SCOPE[&quot;unknown&quot;],</span></span>
<span id="cb8-36"><a href="geodata.html#cb8-36"></a><span class="co">#&gt;         AREA[&quot;World&quot;],</span></span>
<span id="cb8-37"><a href="geodata.html#cb8-37"></a><span class="co">#&gt;         BBOX[-90,-180,90,180]],</span></span>
<span id="cb8-38"><a href="geodata.html#cb8-38"></a><span class="co">#&gt;     ID[&quot;EPSG&quot;,4326]]</span></span>
<span id="cb8-39"><a href="geodata.html#cb8-39"></a></span>
<span id="cb8-40"><a href="geodata.html#cb8-40"></a><span class="co"># alternatively, create sf object with specifying the crs</span></span>
<span id="cb8-41"><a href="geodata.html#cb8-41"></a>waterfalls_sf =<span class="st"> </span><span class="kw">st_as_sf</span>(waterfalls, <span class="dt">coords =</span> <span class="kw">c</span>(<span class="st">&quot;lon&quot;</span>, <span class="st">&quot;lat&quot;</span>), <span class="dt">crs =</span> <span class="dv">4326</span>)</span></code></pre></div>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="geodata.html#cb9-1"></a><span class="co"># transform to the Equal Earth projection (EPSG 8857)</span></span>
<span id="cb9-2"><a href="geodata.html#cb9-2"></a>waterfalls_sf_trans =<span class="st"> </span><span class="kw">st_transform</span>(waterfalls_sf, <span class="dv">8857</span>)</span>
<span id="cb9-3"><a href="geodata.html#cb9-3"></a>waterfalls_sf_trans</span>
<span id="cb9-4"><a href="geodata.html#cb9-4"></a><span class="co">#&gt; Simple feature collection with 3 features and 1 field</span></span>
<span id="cb9-5"><a href="geodata.html#cb9-5"></a><span class="co">#&gt; geometry type:  POINT</span></span>
<span id="cb9-6"><a href="geodata.html#cb9-6"></a><span class="co">#&gt; dimension:      XY</span></span>
<span id="cb9-7"><a href="geodata.html#cb9-7"></a><span class="co">#&gt; bbox:           xmin: -6580000 ymin: -3240000 xmax: 2420000 ymax: 5260000</span></span>
<span id="cb9-8"><a href="geodata.html#cb9-8"></a><span class="co">#&gt; projected CRS:  WGS 84 / Equal Earth Greenwich</span></span>
<span id="cb9-9"><a href="geodata.html#cb9-9"></a><span class="co">#&gt;             name                  geometry</span></span>
<span id="cb9-10"><a href="geodata.html#cb9-10"></a><span class="co">#&gt; 1   Iguazu Falls POINT (-4969711 -3244138)</span></span>
<span id="cb9-11"><a href="geodata.html#cb9-11"></a><span class="co">#&gt; 2  Niagara Falls  POINT (-6583123 5261565)</span></span>
<span id="cb9-12"><a href="geodata.html#cb9-12"></a><span class="co">#&gt; 3 Victoria Falls  POINT (2416945 -2285044)</span></span></code></pre></div>
<p><img src="02-geodata_files/figure-html/crs-trans-plot-1.png" width="672" style="display: block; margin: auto;" /></p>

</div>
</div>
</div>
<h3>References</h3>
<div id="refs" class="references">
<div id="ref-lovelace2019geocomputation">
<p>Lovelace, R, J Nowosad, and J Muenchow. 2019. <em>Geocomputation with R</em>. Chapman and Hall/CRC Press.</p>
</div>
</div>
<div class="footnotes">
<hr />
<ol start="1">
<li id="fn1"><p>Regular grids can also have coordinated changing in different directions, e.g., from bottom to top.<a href="geodata.html#fnref1" class="footnote-back">â†©ï¸Ž</a></p></li>
<li id="fn2"><p>However, any other names are also possible.<a href="geodata.html#fnref2" class="footnote-back">â†©ï¸Ž</a></p></li>
<li id="fn3"><p>It is also possible to read spatial vector data using the <code>st_read()</code> function, which differs from <code>read_sf()</code> by having different default arguments.<a href="geodata.html#fnref3" class="footnote-back">â†©ï¸Ž</a></p></li>
<li id="fn4"><p>The <strong>stars</strong> package also has a function <code>read_ncdf()</code> aimed at improved reading of NetCDF files.<a href="geodata.html#fnref4" class="footnote-back">â†©ï¸Ž</a></p></li>
</ol>
</div>
<script>
/*
Sorts the references alphabetically.
Modified from code by Yvonne Aburrow.
*/
$(function(){
    var elems = $('#refs').children('div').remove();
    elems.sort(function (a, b) {
        return $(b).children('p').html().toUpperCase() > $(a).children('p').html().toUpperCase() ? -1 : 1;
    });
    $('#refs').append(elems);
})
</script>
            </section>

          </div>
        </div>
      </div>
<a href="intro.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="nutshell.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": null,
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/mtennekes/tmap_book/edit/master/02-geodata.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "section"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
